<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Creating a Daemon Process in Python</title>
    <meta name="author" content="Vasudev Kamath" />

    <!-- Normalize CSS -->
    <link rel="stylesheet" href="/css/normalize.css" type="text/css"/>

    <!-- 1140 Grid CSS -->
    <link media="screen" rel="stylesheet" href="/css/1140.css" type="text/css"/>

    <!-- styles.css -->
    <link media="screen" rel="stylesheet" href="/css/styles.css" type="text/css"/>

    <!-- 1140 Grid CSS related javascript -->
    <script src="/js/css3-mediaqueries.js" type="text/javascript"></script>

    
    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="/css/emacs.css" type="text/css" />

    <!-- Webfont url -->
    <link rel="stylesheet" href="/fonts/stylesheet-bitstream.css" type="text/css"/>
    <link rel="stylesheet" href="/fonts/stylesheet-angelina.css" type="text/css"/>
    <link rel="stylesheet" href="/fonts/stylesheet-aargh.css" type="text/css"/>
    <link rel="stylesheet" href="/fonts/stylesheet-lato.css" type="text/css"/>    

    <!-- Homepage CSS -->
    <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
  </head>
  <body>

    <div class="container header">
      <div class="row">
        <div class="site">
          <div class="title">
            <a href="/">Random Ramblings</a>
          </div>
          <div class="subheading">
            Random thoughts shooting out of volatile mind
          </div>
        </div>
      </div>
    </div>
    <div class="container details">
      <div class="row">
        <div class="eightcol">
          <div class="postheading">
  Creating a Daemon Process in Python
</div>
<div class="postbody">
  <div xmlns="http://www.w3.org/1999/xhtml">Daemons in computer world refers to a process that runs in background in a Unix like operating system you can read more on Daemons in this <a href="http://en.wikipedia.org/wiki/Daemon_%28computer_software%29" target="_blank" title="Daemon Process">Wikipedia article</a>. I knew how to create a daemon in the C program but didn't find any good article on how to do it in Python except this <a href="http://code.activestate.com/recipes/278731-creating-a-daemon-the-python-way/" target="_blank" title="Python Daemon">one</a>. The main guidelines for writing a daemon process are as follows<br /><ol><li>First the program needs to fork and parent should exit leaving the child as orphan which will be then adopted by the <b><i>init </i></b>process which is parent of all process in Unix like operating system. Caution: do take care so that your process doesn't end up as a Zombie Process (avoided by doing a double fork. 1st parent forks a child which then forks a second child after forking first child exits and then parent exits and the second child continues to execute as a daemon)<a name='more'></a></li><li>A process has a controlling terminal and receives all signal from the terminal. Child inherits the terminal of process but a daemon should not receive any signal from controlling terminal so we need to disassociate from any terminal and also from process groups. This can be done by creating its own process group and becoming the session leader. To achieve this <b><i>setsid</i></b> system call is used</li><li>By default a child process also inherits open file descriptor from its parent and most of the time it may not be using these resources so its good if we release/close all these file descriptors.</li><li>Next is setting the working directory as / (root) this is done so that process doesn't keep any directory in use on a mounted file system (not allowing to unmount). But using / may not be good in all cases so working directory should be chosen carefully. This can be achived using <b><i>chdir</i></b> system call</li><li>Setting the file creation mask is next step. Normally daemons will be running as super user and files created by it needs to be protected. This can be done by using <b><i>umask</i></b> system call.</li><li>Catching the Signals is the next step. Normally daemon process may get signal from a user or other process. For eg a child process may send SIGCHLD when it terminates. Daemons should catch these signals and act accordingly (except SIGKILL). This can be done using signal handlers utilizing signal.h</li><li>Daemon process won't be attached to any terminals or consoles so messages from daemon process needs to be written to some file or we need to use syslogd interface to log the events which is more flexible.</li></ol>Well that’s about the steps / guide lines to create a daemon processes. Here is the code which I wrote in Python which uses double forking and creates a simple daemon which actually does nothing :P.<br /><script src="http://gist.github.com/596645.js">As you can see this program follows all the 7 steps. I used the double forking method to avoid Zombies. First child becomes session leader using os.setsid and forks second child then it exits. Second child changes the working directory to /tmp and sets umask, at this point parent process is done. Next it tries to close all file descriptor which may have been inherited from parent. I simply go from 0 to max allowed files by the system and try to close each of them. If closing fails it doesn't matter try next one ;). Finally I have a signal handler which handles hangup and terminate signals, child stop etc are ignored. Then in the main part simply loop for ever sleeping for 1 second :D. That’s it your daemon is ready to run. Here is the orignal <a href="http://www.enderunix.org/docs/eng/daemon.php" target="_blank" title="Daemon process in C">C program</a> To check if your program is running just use following command.<blockquote><i>ps -eF | grep test_daemon.py</i></blockquote>Replace with file name you gave. Here is the sample output<blockquote><i>root     18754     1  0  2533  2308   0 21:31 ?        00:00:00 /usr/bin/python ./test_daemon.py</i></blockquote>1 in the third column indicates that this process's parent is init. Try following commands <blockquote><i>kill -HUP 18574</i></blockquote><blockquote><i>kill 18574</i></blockquote>Now if you see the log file in /tmp/pydaemond.log you will see signal handler has caught the signals and logged it. PID can be found in the /tmp/pydaemond.lock file. Change the file name and directory to suit your needs. Thats all for now C ya.Vasudev</div></script></div>

  <br/>
  <div class="meta_wrapper">
<ul class="tag_list_in_post">
    
    <li class="inline tag_list_item"><a class="tag_list_link" href="/tag/daemon process">daemon process</a></li>
    
    <li class="inline tag_list_item"><a class="tag_list_link" href="/tag/Programming">Programming</a></li>
    
    <li class="inline tag_list_item"><a class="tag_list_link" href="/tag/python">python</a></li>
    
</ul>
</div>
  
</div>
<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
    <li><span>11 Mar 2012</span> &raquo; <a href="/2012/03/hello_planet%21.html">Hello Planet! (Debian)</a></li>
    
    <li><span>10 Mar 2012</span> &raquo; <a href="/2012/03/ttf-indic-fonts_to_fonts-indic_transition_complete%21.html">ttf-indic-fonts to fonts-indic transition complete!</a></li>
    
    <li><span>04 Mar 2012</span> &raquo; <a href="/2012/03/lato_fonts_for_debian.html">Lato Fonts for Debian</a></li>
    
  </ul>
</div>

<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'randramblings'; // required: replace example with your forum shortname

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

        </div>
        <div class="fourcol last">
          <div class="main-menu">
            <div id="home-menu" class="main-menu-item "> <a href="/"> Home </a></div>
            <div id="me-menu" class="main-menu-item "><a href="/about"> About </a></div>
            <div id="project-menu" class="main-menu-item"> Projects and Talks </div>
            <div id="archive-menu" class="main-menu-item "> <a href="/archives"> Archives </a></div>
            <div id="package-menu" class="main-menu-item"> <a href="http://qa.debian.org/developer.php?login=kamathvasudev@gmail.com"> Debian Packages </a> </div>
          </div>
          <br/>
          <hr/>
          <br/>
          <div class="widget">
            Follow Me
            <br/>
            <br/>
            <a href="http://frndk.de/profile/copyninja"><image class="badge" src="/images/iamusingfriendika.png"/></a>
          </div>
          <br/>
          <hr/>
          <br/>
          <a href=><img src= "http://pics8.inxhost.com/images/sticker.gif" border="0" width="80" height="15"/></a>
          <a href="/rss"><img class="badge" width="73" height="18" longdesc="/rss" alt="XML: RSS Feed" src="/images/rssbutton.png"></a>
          <a href="/atom"><img class="badge" width="73" height="18" longdesc="/atom" alt="XML: Atom Feed" src="/images/atombutton.png"></a>
          <a href='https://www.ohloh.net/accounts/153053?ref=Tiny'>
            <img alt='Ohloh profile for copyninja' height='15' src='https://www.ohloh.net/accounts/153053/widgets/account_tiny.gif' width='80' />
          </a>
          <a href='http://www.catb.org/hacker-emblem/'>
            <img src='/images/hacker.png' alt='hacker emblem' />
          </a>
          <br/>
          <br/><a href="http://www.adfreeblog.org/" target="_blank"> <img src="http://www.adfreeblog.org/adfreebutton.jpg"></a>
          <br/>
          <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">
            <img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by/3.0/88x31.png" />
          </a>
          <br/>
</a>          
</div>
</div>
</div>

<!-- Footer -->
<div class="container footer">
  <div class="site">
    <div class="row">
      <div class="footer">
        <div class="contact">
          <p>
            (c) 2012 Vasudeva Kamath<br />
            <br/>
            This blog is powered by <b> Jekyll </b> and <b>Emacs</b>
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
<a href="http://github.com/copyninja"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" /></a>

</body>
</html>


